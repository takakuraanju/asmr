import{B as V,i as ve,C as be,D as _e,E as O,r as Ie,p as ze,q as Ce,F as Le,G as Ee,H as xe,I as Ne,_ as me,J as M,t as B,K as Se}from"./index-e8ef4e39.js";import{$ as Oe,B as pe,C as re,N as de,D as Q,_ as fe,a0 as ge,G as we,a1 as Te,r as b,a2 as Re,z as $e,k as v,w as ie,H as ye,j as he,o as y,c as ue,d as c,b as I,e as w,n as d,f as a,m as ce,q as Ae,s as z,l as N,F as U,W as Be,V as Ve,R as Me,S as De,K as J,a3 as Ye,a4 as Fe,a5 as He,T as ke,a6 as Xe,t as Pe,a7 as Ke,a8 as We,M as je}from"./index-4ba2d79a.js";import{d as qe,g as Ge}from"./format-54ff4f88.js";import{u as Ze}from"./index-23229e5d.js";const Je=(i,f)=>{if(!V||!i||!f)return!1;const o=i.getBoundingClientRect();let s;return f instanceof Element?s=f.getBoundingClientRect():s={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},o.top<s.bottom&&o.bottom>s.top&&o.right>s.left&&o.left<s.right};var Ue="Expected a function";function le(i,f,o){var s=!0,h=!0;if(typeof i!="function")throw new TypeError(Ue);return Oe(o)&&(s="leading"in o?!!o.leading:s,h="trailing"in o?!!o.trailing:h),qe(i,f,{leading:s,maxWait:f,trailing:h})}const Qe=pe({urlList:{type:re(Array),default:()=>ve([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),et={close:()=>!0,switch:i=>de(i)},tt=["src"],at=Q({name:"ElImageViewer"}),nt=Q({...at,props:Qe,emits:et,setup(i,{expose:f,emit:o}){const s=i,h={CONTAIN:{name:"contain",icon:fe(be)},ORIGINAL:{name:"original",icon:fe(_e)}},{t:C}=ge(),r=we("image-viewer"),{nextZIndex:ee}=Te(),T=b(),S=b([]),L=Re(),_=b(!0),m=b(s.initialIndex),p=$e(h.CONTAIN),u=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),D=v(()=>{const{urlList:e}=s;return e.length<=1}),$=v(()=>m.value===0),X=v(()=>m.value===s.urlList.length-1),te=v(()=>s.urlList[m.value]),ae=v(()=>[r.e("btn"),r.e("prev"),r.is("disabled",!s.infinite&&$.value)]),Y=v(()=>[r.e("btn"),r.e("next"),r.is("disabled",!s.infinite&&X.value)]),ne=v(()=>{const{scale:e,deg:n,offsetX:l,offsetY:g,enableTransition:E}=u.value;let k=l/e,x=g/e;switch(n%360){case 90:case-270:[k,x]=[x,-k];break;case 180:case-180:[k,x]=[-k,-x];break;case 270:case-90:[k,x]=[-x,k];break}const A={transform:`scale(${e}) rotate(${n}deg) translate(${k}px, ${x}px)`,transition:E?"transform .3s":""};return p.value.name===h.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),P=v(()=>de(s.zIndex)?s.zIndex:ee());function R(){oe(),o("close")}function se(){const e=le(l=>{switch(l.code){case B.esc:s.closeOnPressEscape&&R();break;case B.space:q();break;case B.left:G();break;case B.up:t("zoomIn");break;case B.right:Z();break;case B.down:t("zoomOut");break}}),n=le(l=>{const g=l.deltaY||l.deltaX;t(g<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});L.run(()=>{M(document,"keydown",e),M(document,"wheel",n)})}function oe(){L.stop()}function K(){_.value=!1}function W(e){_.value=!1,e.target.alt=C("el.image.error")}function j(e){if(_.value||e.button!==0||!T.value)return;u.value.enableTransition=!1;const{offsetX:n,offsetY:l}=u.value,g=e.pageX,E=e.pageY,k=le(A=>{u.value={...u.value,offsetX:n+A.pageX-g,offsetY:l+A.pageY-E}}),x=M(document,"mousemove",k);M(document,"mouseup",()=>{x()}),e.preventDefault()}function F(){u.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function q(){if(_.value)return;const e=He(h),n=Object.values(h),l=p.value.name,E=(n.findIndex(k=>k.name===l)+1)%e.length;p.value=h[e[E]],F()}function H(e){const n=s.urlList.length;m.value=(e+n)%n}function G(){$.value&&!s.infinite||H(m.value-1)}function Z(){X.value&&!s.infinite||H(m.value+1)}function t(e,n={}){if(_.value)return;const{zoomRate:l,rotateDeg:g,enableTransition:E}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(e){case"zoomOut":u.value.scale>.2&&(u.value.scale=Number.parseFloat((u.value.scale/l).toFixed(3)));break;case"zoomIn":u.value.scale<7&&(u.value.scale=Number.parseFloat((u.value.scale*l).toFixed(3)));break;case"clockwise":u.value.deg+=g;break;case"anticlockwise":u.value.deg-=g;break}u.value.enableTransition=E}return ie(te,()=>{ye(()=>{const e=S.value[0];e!=null&&e.complete||(_.value=!0)})}),ie(m,e=>{F(),o("switch",e)}),he(()=>{var e,n;se(),(n=(e=T.value)==null?void 0:e.focus)==null||n.call(e)}),f({setActiveItem:H}),(e,n)=>(y(),ue(Fe,{to:"body",disabled:!e.teleported},[c(Ye,{name:"viewer-fade",appear:""},{default:I(()=>[w("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:d(a(r).e("wrapper")),style:ce({zIndex:a(P)})},[w("div",{class:d(a(r).e("mask")),onClick:n[0]||(n[0]=Ae(l=>e.hideOnClickModal&&R(),["self"]))},null,2),z(" CLOSE "),w("span",{class:d([a(r).e("btn"),a(r).e("close")]),onClick:R},[c(a(O),null,{default:I(()=>[c(a(Ie))]),_:1})],2),z(" ARROW "),a(D)?z("v-if",!0):(y(),N(U,{key:0},[w("span",{class:d(a(ae)),onClick:G},[c(a(O),null,{default:I(()=>[c(a(ze))]),_:1})],2),w("span",{class:d(a(Y)),onClick:Z},[c(a(O),null,{default:I(()=>[c(a(Ce))]),_:1})],2)],64)),z(" ACTIONS "),w("div",{class:d([a(r).e("btn"),a(r).e("actions")])},[w("div",{class:d(a(r).e("actions__inner"))},[c(a(O),{onClick:n[1]||(n[1]=l=>t("zoomOut"))},{default:I(()=>[c(a(Le))]),_:1}),c(a(O),{onClick:n[2]||(n[2]=l=>t("zoomIn"))},{default:I(()=>[c(a(Ee))]),_:1}),w("i",{class:d(a(r).e("actions__divider"))},null,2),c(a(O),{onClick:q},{default:I(()=>[(y(),ue(Be(a(p).icon)))]),_:1}),w("i",{class:d(a(r).e("actions__divider"))},null,2),c(a(O),{onClick:n[3]||(n[3]=l=>t("anticlockwise"))},{default:I(()=>[c(a(xe))]),_:1}),c(a(O),{onClick:n[4]||(n[4]=l=>t("clockwise"))},{default:I(()=>[c(a(Ne))]),_:1})],2)],2),z(" CANVAS "),w("div",{class:d(a(r).e("canvas"))},[(y(!0),N(U,null,Ve(e.urlList,(l,g)=>Me((y(),N("img",{ref_for:!0,ref:E=>S.value[g]=E,key:l,src:l,style:ce(a(ne)),class:d(a(r).e("img")),onLoad:K,onError:W,onMousedown:j},null,46,tt)),[[De,g===m.value]])),128))],2),J(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var st=me(nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const ot=ke(st),lt=pe({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:re([String,Object])},previewSrcList:{type:re(Array),default:()=>ve([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),rt={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>de(i),close:()=>!0,show:()=>!0},it=["src","loading"],ut={key:0},ct=Q({name:"ElImage",inheritAttrs:!1}),dt=Q({...ct,props:lt,emits:rt,setup(i,{emit:f}){const o=i;let s="";const{t:h}=ge(),C=we("image"),r=Xe(),ee=Ze(),T=b(),S=b(!1),L=b(!0),_=b(!1),m=b(),p=b(),u=V&&"loading"in HTMLImageElement.prototype;let D,$;const X=v(()=>[C.e("inner"),Y.value&&C.e("preview"),L.value&&C.is("loading")]),te=v(()=>r.style),ae=v(()=>{const{fit:t}=o;return V&&t?{objectFit:t}:{}}),Y=v(()=>{const{previewSrcList:t}=o;return Array.isArray(t)&&t.length>0}),ne=v(()=>{const{previewSrcList:t,initialIndex:e}=o;let n=e;return e>t.length-1&&(n=0),n}),P=v(()=>o.loading==="eager"?!1:!u&&o.loading==="lazy"||o.lazy),R=()=>{V&&(L.value=!0,S.value=!1,T.value=o.src)};function se(t){L.value=!1,S.value=!1,f("load",t)}function oe(t){L.value=!1,S.value=!0,f("error",t)}function K(){Je(m.value,p.value)&&(R(),F())}const W=Se(K,200,!0);async function j(){var t;if(!V)return;await ye();const{scrollContainer:e}=o;We(e)?p.value=e:je(e)&&e!==""?p.value=(t=document.querySelector(e))!=null?t:void 0:m.value&&(p.value=Ge(m.value)),p.value&&(D=M(p,"scroll",W),setTimeout(()=>K(),100))}function F(){!V||!p.value||!W||(D==null||D(),p.value=void 0)}function q(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}function H(){Y.value&&($=M("wheel",q,{passive:!1}),s=document.body.style.overflow,document.body.style.overflow="hidden",_.value=!0,f("show"))}function G(){$==null||$(),document.body.style.overflow=s,_.value=!1,f("close")}function Z(t){f("switch",t)}return ie(()=>o.src,()=>{P.value?(L.value=!0,S.value=!1,F(),j()):R()}),he(()=>{P.value?j():R()}),(t,e)=>(y(),N("div",{ref_key:"container",ref:m,class:d([a(C).b(),t.$attrs.class]),style:ce(a(te))},[S.value?J(t.$slots,"error",{key:0},()=>[w("div",{class:d(a(C).e("error"))},Pe(a(h)("el.image.error")),3)]):(y(),N(U,{key:1},[T.value!==void 0?(y(),N("img",Ke({key:0},a(ee),{src:T.value,loading:t.loading,style:a(ae),class:a(X),onClick:H,onLoad:se,onError:oe}),null,16,it)):z("v-if",!0),L.value?(y(),N("div",{key:1,class:d(a(C).e("wrapper"))},[J(t.$slots,"placeholder",{},()=>[w("div",{class:d(a(C).e("placeholder"))},null,2)])],2)):z("v-if",!0)],64)),a(Y)?(y(),N(U,{key:2},[_.value?(y(),ue(a(ot),{key:0,"z-index":t.zIndex,"initial-index":a(ne),infinite:t.infinite,"zoom-rate":t.zoomRate,"url-list":t.previewSrcList,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:G,onSwitch:Z},{default:I(()=>[t.$slots.viewer?(y(),N("div",ut,[J(t.$slots,"viewer")])):z("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],6))}});var ft=me(dt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const wt=ke(ft);export{wt as E};
